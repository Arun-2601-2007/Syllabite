<% layout('LAYOUTS/boilerplate.ejs') %>


<body>
    <%- include('../INCLUDES/navbar.ejs') %>
     <%- include("../INCLUDES/flash.ejs") %>
   
    <div class="container mb-3 mt-3">
        <% let count = 0; %>
        <% let semNumbers = ["SEMESTER ONE","SEMESTER TWO","SEMESTER THREE","SEMESTER FOUR","SEMESTER FIVE","SEMESTER SIX","SEMESTER SEVEN","SEMESTER EIGHT"]; %> 
        <% for (let semKey in departmentData) { %>
            <%if (semKey.startsWith('semester')) {%> 
                <% let semData = departmentData[semKey]; %>
            <div class="mt-2" id="semGroup<%= count %>">
                <p class="d-inline-flex gap-1">
                    
                        <div class="sem" data-bs-toggle="collapse" href="#sem<%= count %>" aria-expanded="false" aria-controls="sem<%= count %>">
                        <%= semNumbers[count] %>
                        </div>  
                </p>
                <div class="collapse" id="sem<%= count %>" data-bs-parent="#semGroup<%= count %>">
                    <div class="card card-body">
                        <% let subCount = 0; %>
                        
                        <% for (let course of semData) { %>
                            <div id="semSubGroup<%= count %>_<%= subCount %>">
                                <p class="d-inline-flex gap-1">
                                    
                                    <div class="sem" data-bs-toggle="collapse" href="#sem<%= count %>_<%= subCount %>" aria-expanded="false" aria-controls="sem<%= count %>_<%= subCount %>">
                                        <%= course.subject %>
                                        
                                    </div>
                                </p>
                                <div class="collapse" id="sem<%= count %>_<%= subCount %>">
                                    <div class="card card-body inner">
                                        <div class="container">
                                            <div class="row text-center  font">
                                                <!-- <div class="col-1 d-flex justify-content-center imp"><p>Status</p> <i class="d-sm-none fa-solid fa-check" style="color: rgb(105, 182, 234)"></i></div> -->
                                                 
                                                <div class="col-5 text-center imp">Playlist Number</div>
                                                <div class="col-2 text-center imp"><p>Resource</p><i class="d-sm-none text-center fa-solid fa-circle-play" style="color: rgb(61, 190, 241); "></i></div>
                                                <div class="col-3 text-center imp"><p>PYQ's & Ref</p><i class="d-sm-none text-center fa-solid fa-file" style="color: orange;"></i></div>
                                                <div class="col-1 text-center imp">
                                                    <button class="btn btn-sm" style="background: linear-gradient(to right, #d4fcf4, #8ed6ff); color: black;"><a href="/upload" style="text-decoration: none; color: black;">Upload</a></button><a href="/upload" style="text-decoration: none; color: black;"><i class="fa-solid fa-cloud-arrow-up" style="color: #06b6d4;"></i></a>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="mt-1">
                                        <% let count1 = 1; %>
                                        <% let pdfs = course.pyq%>
                                        <% let pdfLen = course.pyq.length %>
                                        
                                        <% let playlists = course.playlists %>
                                        
                                        <% let playLen = playlists.length %>
                                        <% let maxLen = Math.max(playlists.length, pdfs.length); %>
                                        <% for(let i=0;i<maxLen;i++){%>
                                        
                                            <div class="container mt-1">
                                                <div class="row text-center">
                                   

                                                    
                                                     <% if(i < playLen) {%>
                                                        <div class="col-5 adjust1">PLAYLIST &nbsp; <%= count1 %></div>
                                                        <div class="col-2">
                                                            <form method="POST" action="/deleteLink/<%=departmentData._id.toString()%>/<%=semKey%>/<%=course._id%>" class="needs-validation" novalidate>
                                                                <% if(ids.includes(currUser._id.toString())) {%>
                                                                    <button type="submit" style="display: inline;" ><a><i class="fa-solid fa-trash " style="color: red;"></i></a></button>
                                                                 <% } %>
                                                                <input type="hidden" name="playlistLink" value="<%= playlists[i] %>">
                                                                <a  href="<%= playlists[i] %>" target="_blank">
                                                         
                                                                    <i class="fa-brands fa-youtube adjSize" style="color: rgb(61, 190, 241); font-size: 1.5rem;"></i>
                                                                </a>
                                                            </form>
                                                        </div>
                                                        
                                                    
                                                    
                                                    <% }else {%>
                                                        <div class="col-5"> _ </div>
                                                    <a class="col-2" href="">
                                                        _
                                                    </a>
                                                    <% }%>
                                                     <% if(i<pdfLen) {%>
                                                        <div class="col-3">
                                                            <div class="row">
                                                            <form method="POST" action="/delete/<%=departmentData._id.toString()%>/<%=semKey%>/<%=course._id%>" class="needs-validation" novalidate>
                                                                <% if(ids.includes(currUser._id.toString())) {%>
                                                                    <button type="submit" style="display: inline;"><a ><i class="fa-solid fa-trash " style="color: red;"></i></a></button>
                                                                 <% } %>
                                                                <input type="hidden" name="pdfLink" value="<%= pdfs[i] %>">
                                                                 <a   href="<%= pdfs[i] %>" target="_blank"><i class="fa-solid fa-file adjSize" style="color: orange; font-size: 1.4rem;"></i></a>
                                                            </form>
                                                            
                                                            
                                                            </div>
                                                            
                                                            

                        
                                                    </div>
                                                    
                                                    <% }else {%>
                                                        <div class="col-3"> _ </div>
                                                    
                                                    <% }%>
                                                    
                                                </div>
                                            </div>
                                            <% count1++; %>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            <% subCount++; %>
                        <% } %>
                    </div>
                </div>
            </div>
            <% count++; %>
            <% } %>
            
        <% } %>
       
    </div>
    <div class="container text-center mb-4 mt-2">
        
            <div class="col-12 text-center ">
                <button class="btn" style="background: linear-gradient(to right, #d4fcf4, #8ed6ff); color: black;"><a href="/upload/link" style="text-decoration: none; color: black;">Upload PlayList Link</a></button><a href="/upload" style="text-decoration: none; color: black;"></a>
                
            </div>
        
    </div>
    <div class="container">
    <div class="container mb-5 box ">
    <% if(currUser) { %>
        
        <div class="container mt-3">
            <h2 class="text-center mt-2">Review</h2>
            <form method="POST" action="/<%= departmentData._id%>/reviews" class="needs-validation" novalidate>
                
                <div class="form-floating">
                    <textarea name="review[comment]" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px" required></textarea>
                    <div class="invalid-feedback">Please write some comment.</div>
                    <label for="floatingTextarea2">Comment</label>
                </div>
                 <div class=" mt-3 ms-1">
                
                    <label for="rating" class="form-label">
                            <p>Rating</p>
                    </label>
                    <fieldset class="starability-slot sizes">
            
                        
                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                        <label for="first-rate1" title="Terrible">1 star</label>
                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                        <label for="first-rate2" title="Not good">2 stars</label>
                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                        <label for="first-rate3" title="Average">3 stars</label>
                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                        <label for="first-rate4" title="Very good">4 stars</label>
                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                        <label for="first-rate5" title="Amazing">5 stars</label>
                    </fieldset>
                </div>
                
                <button class="mt-3 btn mb-3" type="submit" style="width: 100%; background: linear-gradient(to right, #d4fcf4, #8ed6ff); color: black;" class="btn btn-primary">Submit</button>
            </form>
        
            <hr>
            <h2 class="text-center">All Reviews</h2>
            <div class="row mb-5  justify-content-evenly">
                <% for(let review of departmentData.reviews) {%>
                <div class="card col-md-5 mb-3">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fa-solid fa-circle-user" style="font-size:x-large; color: #6b7280;" ></i> &nbsp; <%= review.author.username %> </h5>
                        <p class="card-text"><%= review.comment %></p>
                        
                        <p class="starability-result sizes" data-rating="<%= review.rating %>">Rated : <%= review.rating %> stars</p>
                        <form action="/department/<%=departmentData._id %>/reviews/<%= review._id %> "  method="POST">
                            
                            <button class="btn" style=" background: linear-gradient(to right, #d4fcf4, #8ed6ff); color: black;">Delete</button>
                        
                        </form>
                        
                    </div>
                </div>
            <% }%>
            </div>
            
        </div>
    </div>
    <% } %>
    </div>
    </div>
    <%- include('../INCLUDES/footer.ejs') %>
</body>

